(function(t){function e(e){for(var n,r,s=e[0],c=e[1],l=e[2],d=0,h=[];d<s.length;d++)r=s[d],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&h.push(i[r][0]),i[r]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);u&&u(e);while(h.length)h.shift()();return o.push.apply(o,l||[]),a()}function a(){for(var t,e=0;e<o.length;e++){for(var a=o[e],n=!0,s=1;s<a.length;s++){var c=a[s];0!==i[c]&&(n=!1)}n&&(o.splice(e--,1),t=r(r.s=a[0]))}return t}var n={},i={app:0},o=[];function r(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=n,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(a,n,function(e){return t[e]}.bind(null,n));return a},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var l=0;l<s.length;l++)e(s[l]);var u=c;o.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"56d7":function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-app",{attrs:{id:"inspire"}},[a("v-app-bar",{attrs:{app:"","clipped-right":"","clipped-left":"",color:t.barColor,dark:""}},[a("v-app-bar-nav-icon",{on:{click:function(e){e.stopPropagation(),t.drawer=!t.drawer}}}),a("v-toolbar-title",[t._v("OnlinePS")]),a("v-spacer"),a("v-app-bar-nav-icon",{on:{click:function(e){e.stopPropagation(),t.drawerRight=!t.drawerRight}}})],1),a("v-navigation-drawer",{attrs:{app:"",width:"auto",right:"",clipped:""},model:{value:t.drawerRight,callback:function(e){t.drawerRight=e},expression:"drawerRight"}},[a("v-list",{attrs:{dense:""}},[a("v-list-item",[a("history")],1)],1)],1),a("v-navigation-drawer",{attrs:{app:"",width:"auto",clipped:""},model:{value:t.drawer,callback:function(e){t.drawer=e},expression:"drawer"}},[a("v-list",{attrs:{dense:""}},[a("v-list-item",[a("Edits")],1)],1)],1),a("v-navigation-drawer",{attrs:{fixed:"",temporary:""},model:{value:t.left,callback:function(e){t.left=e},expression:"left"}}),a("v-content",[a("v-container",{staticClass:"fill-height",attrs:{fluid:""}},[a("v-row",{attrs:{justify:"center",align:"center"}},[a("midBlock",{on:{canvasReady:t.canvasReady}})],1)],1)],1),a("v-navigation-drawer",{attrs:{fixed:"",right:"",temporary:""},model:{value:t.right,callback:function(e){t.right=e},expression:"right"}}),a("v-footer",{staticClass:"white--text",attrs:{app:"",color:t.barColor}},[a("span",[t._v("SETeam06")]),a("v-spacer"),a("span",[t._v("© 2020")])],1)],1)},o=[],r=a("5530"),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-container",{attrs:{fluid:""},on:{mousedown:function(e){return t.mouseDownEvent(e)},mousemove:function(e){return t.mouseMoveEvent(e)},mouseup:function(e){return t.mouseReleaseEvent(e)}}},[n("v-row",[n("v-col",{attrs:{cols:"12"}},[n("v-row",{directives:[{name:"show",rawName:"v-show",value:t.scaleState,expression:"scaleState"}],attrs:{align:"stretch",justify:"center"}},[n("v-col",{attrs:{cols:"6"}},[n("v-slider",{staticClass:"align-center",attrs:{max:t.max,min:"0","thumb-label":"always"},scopedSlots:t._u([{key:"thumb-label",fn:function(e){var a=e.value;return[t._v(" "+t._s(a/100)+"x ")]}}]),model:{value:t.editScale,callback:function(e){t.editScale=e},expression:"editScale"}})],1),n("v-btn",{staticClass:"mx-2",attrs:{outlined:"",fab:"",small:"",color:"indigo"},on:{click:function(e){return t.endScaling(1)}}},[n("v-icon",[t._v("mdi-check")])],1),n("v-btn",{staticClass:"mx-2",attrs:{outlined:"",fab:"",small:"",color:"indigo"},on:{click:function(e){return t.endScaling(0)}}},[n("v-icon",[t._v("mdi-close")])],1)],1),n("v-row",{directives:[{name:"show",rawName:"v-show",value:t.rotateState,expression:"rotateState"}],attrs:{align:"stretch",justify:"center"}},[n("v-col",{attrs:{cols:"6"}},[n("v-slider",{staticClass:"align-left",attrs:{max:360,min:"0","thumb-label":"always"},scopedSlots:t._u([{key:"thumb-label",fn:function(e){var a=e.value;return[t._v(" "+t._s(a)+"° ")]}}]),model:{value:t.editRotate,callback:function(e){t.editRotate=e},expression:"editRotate"}})],1),n("v-btn",{staticClass:"mx-2",attrs:{outlined:"",fab:"",small:"",color:"indigo"},on:{click:function(e){return t.endRotating(1)}}},[n("v-icon",[t._v("mdi-check")])],1),n("v-btn",{staticClass:"mx-2",attrs:{outlined:"",fab:"",small:"",color:"indigo"},on:{click:function(e){return t.endRotating(0)}}},[n("v-icon",[t._v("mdi-close")])],1)],1),n("v-row",{directives:[{name:"show",rawName:"v-show",value:t.clipState,expression:"clipState"}],attrs:{align:"stretch",justify:"center"}},[n("v-btn",{staticClass:"mx-2 my-1",attrs:{outlined:"",fab:"",small:"",color:"indigo"},on:{click:function(e){return t.endClip(1)}}},[n("v-icon",[t._v("mdi-check")])],1),n("v-btn",{staticClass:"mx-2 my-1",attrs:{outlined:"",fab:"",small:"",color:"indigo"},on:{click:function(e){return t.endClip(0)}}},[n("v-icon",[t._v("mdi-close")])],1)],1),n("v-row",{staticClass:"grey lighten-5",attrs:{id:"canvasWrapper",align:"center",justify:"center"}},[n("img",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{crossorigin:"",id:"myImg1",src:a("a76c")}}),n("img",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{crossorigin:"",id:"myImg2",src:a("b977")}}),n("img",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{crossorigin:"",id:"myImg3",src:a("c039")}}),n("div",{directives:[{name:"show",rawName:"v-show",value:t.clipState,expression:"clipState"}],staticStyle:{position:"absolute","z-index":"1"},attrs:{id:"clipFrame"}},[n("div",{staticStyle:{cursor:"move"},style:[t.boxStyle],attrs:{id:"box"}},[n("div",{staticStyle:{left:"-3px",top:"-3px",cursor:"nw-resize"},style:[t.dotStyle],attrs:{id:"LU"}}),n("div",{staticStyle:{left:"-3px",bottom:"-3px",cursor:"sw-resize"},style:[t.dotStyle],attrs:{id:"LD"}}),n("div",{staticStyle:{right:"-3px",top:"-3px",cursor:"ne-resize"},style:[t.dotStyle],attrs:{id:"RU"}}),n("div",{staticStyle:{right:"-3px",bottom:"-3px",cursor:"se-resize"},style:[t.dotStyle],attrs:{id:"RD"}}),n("div",{staticStyle:{top:"-3px",left:"50%","margin-left":"-3px",cursor:"n-resize"},style:[t.dotStyle],attrs:{id:"UC"}}),n("div",{staticStyle:{bottom:"-3px",left:"50%","margin-left":"-3px",cursor:"s-resize"},style:[t.dotStyle],attrs:{id:"DC"}}),n("div",{staticStyle:{right:"-3px",top:"50%","margin-top":"-3px",cursor:"e-resize"},style:[t.dotStyle],attrs:{id:"RC"}}),n("div",{staticStyle:{left:"-3px",top:"50%","margin-top":"-3px",cursor:"w-resize"},style:[t.dotStyle],attrs:{id:"LC"}})])]),n("canvas",{staticStyle:{position:"absolute"},attrs:{id:"myCanvas"}}),n("canvas",{staticStyle:{position:"absolute"},attrs:{id:"clipMask"}})]),n("v-row",{directives:[{name:"show",rawName:"v-show",value:t.showBottomBar,expression:"showBottomBar"}],attrs:{id:"barWrapper",align:"stretch",justify:"center"}},[n("v-col",{attrs:{cols:"5"}},[t.hackReset?n("v-select",{attrs:{label:"选择图片",items:t.defaultImgs,"item-text":"name","item-value":"value",outlined:""},on:{change:t.showWarningMsg},model:{value:t.choice,callback:function(e){t.choice=e},expression:"choice"}}):t._e()],1),n("input",{staticStyle:{display:"none"},attrs:{id:"uploadImg",type:"file"},on:{change:t.getUserImg}}),n("v-btn",{staticClass:"ma-4",on:{click:t.download}},[t._v(" 保存图片 ")])],1)],1)],1)],1)},c=[],l=(a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("96cf"),a("1da1")),u=a("2f62"),d={name:"midBlock",data:function(){return{choice:1,lastChoice:1,confirmChange:!0,defaultImgs:[{name:"flower",value:1},{name:"nature",value:2},{name:"person",value:3},{name:"custom",value:0}],firstCallHandler:!0,hackReset:!0,dotStyle:{position:"absolute",width:"6px",height:"6px",border:"1px solid #000",background:"white",overflow:"hidden"}}},watch:{choice:{handler:function(t,e){var a=this;console.log("监听到改变: ",t,e,"用户是否确认改变: ",this.confirmChange),this.lastChoice=e,this.confirmChange?this.changeImg(t):this.firstCallHandler?(this.firstCallHandler=!1,this.choice=this.lastChoice,this.hackReset=!1,this.$nextTick((function(){a.hackReset=!0}))):this.firstCallHandler=!0}},editScale:{handler:function(){this.reScale()}},editRotate:{handler:function(){this.reRotate()}}},computed:Object(r["a"])({},Object(u["e"])(["opList","canvas","cxt","clipMask","maskCxt","edgeW","edgeH","showBottomBar"]),{},Object(u["e"])("clip",["clipState","boxStyle","boxStyle"]),{},Object(u["e"])("scale",["scaleState","scaleRatio","max"]),{},Object(u["e"])("rotate",["rotateState","theta"]),{editScale:{get:function(){return this.scaleRatio},set:function(t){this.setScaleRatio(t)}},editRotate:{get:function(){return this.theta},set:function(t){this.setTheta(t)}}}),mounted:function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(){var e,a,n,i,o,r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(console.log("进入图片预设函数"),e=document.getElementById("canvasWrapper"),a=document.getElementsByClassName("v-content__wrap"),console.log(a),e.style.height=a[0].clientHeight-170+"px",this.setEdge({edgeH:a[0].clientHeight-220,edgeW:a[0].clientWidth}),n=document.getElementById("myCanvas"),i=document.getElementById("clipMask"),o=document.getElementById("clipFrame"),!n.getContext){t.next=22;break}return console.log("浏览器支持Canvas!"),r=n.getContext("2d"),s=i.getContext("2d"),this.setCanvas({canvas:n,cxt:r,clipMask:i,maskCxt:s,clipFrame:o}),console.log("画布与接口初始化完成"),t.next=17,this.fillCanvas(1,this.callback);case 17:console.log("画布准备完毕",this.canvas,this.cxt),this.storeOriginImgInfo(),this.$emit("canvasReady"),t.next=23;break;case 22:alert("抱歉，您的浏览器不支持Canvas，请更新版本后重试");case 23:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),methods:Object(r["a"])({},Object(u["d"])(["setCanvas","storeOriginImgInfo","setEdge"]),{},Object(u["d"])("clip",["mouseDownEvent"]),{},Object(u["d"])("scale",["setScaleRatio"]),{},Object(u["d"])("rotate",["setTheta"]),{},Object(u["b"])("clip",["mouseMoveEvent","mouseReleaseEvent","endClip"]),{},Object(u["b"])("scale",["reScale","endScaling"]),{},Object(u["b"])("rotate",["reRotate","endRotating"]),{download:function(){console.log("图片下载到本地");var t=document.createElement("a");this.canvas.toBlob((function(e){t.download="imgFile.jpg",t.href=URL.createObjectURL(e),t.click()}),"image/jpeg",1)},getUserImg:function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=document.getElementById("uploadImg"),0!=e.files.length){t.next=4;break}return console.log("没有可用文件"),t.abrupt("return");case 4:return a=void 0,t.next=7,this.getRawImgData(e.files[0]).then((function(t){a=t}));case 7:this.changeImg(a);case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),showWarningMsg:function(){this.confirmChange=confirm("更改图片后，当前画布上的图片将会丢失，是否确认？")},getRawImgData:function(t){return new Promise((function(e){var a=new FileReader;a.readAsDataURL(t),a.onload=function(t){e(t.target.result)}}))},changeImg:function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.opList.clear(),0==e&&document.getElementById("uploadImg").click(),t.next=4,this.fillCanvas(e,this.callback);case 4:console.log("画布准备完毕",this.canvas,this.cxt),this.storeOriginImgInfo(),this.$emit("canvasReady");case 7:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),fillCanvas:function(t,e){return new Promise((function(a){var n=void 0;1==t||2==t||3==t?n=document.getElementById("myImg"+t):(n=new Image,n.crossOrigin="",n.src=t),n.onload=function(){console.log("调用onload"),e(n),a()},n.complete&&(console.log("调用complete"),e(n),a())}))},callback:function(t){console.log("清空画布"),this.cxt.clearRect(0,0,this.canvas.offsetWidth,this.canvas.offsetHeight),this.canvas.width=Math.min(this.edgeW,t.width),this.canvas.height=Math.min(this.edgeH,t.height);var e=this.canvas.width/t.width,a=this.canvas.height/t.height,n=e<a?e:a;n=Math.min(1,n);var i=t.width*n,o=t.height*n;this.canvas.width=i,this.canvas.height=o,this.cxt.drawImage(t,0,0,i,o),console.log("画布绘制完成")}})},h=d,m=a("2877"),g=a("6544"),p=a.n(g),v=a("8336"),f=a("62ad"),x=a("a523"),b=a("132d"),w=a("0fd9"),S=a("b974"),k=a("ba0d"),I=Object(m["a"])(h,s,c,!1,null,null,null),y=I.exports;p()(I,{VBtn:v["a"],VCol:f["a"],VContainer:x["a"],VIcon:b["a"],VRow:w["a"],VSelect:S["a"],VSlider:k["a"]});var C=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-container",{attrs:{fluid:""}},[a("v-list",t._l(t.items,(function(e){return a("v-list-group",{key:e.title,attrs:{"prepend-icon":e.icon,"no-action":""},scopedSlots:t._u([{key:"activator",fn:function(){return[a("v-list-item-content",[a("v-list-item-title",{domProps:{textContent:t._s(e.title)}})],1)]},proxy:!0}],null,!0)},t._l(e.items,(function(e){return a("v-list-item",{key:e.title,on:{click:function(t){return e.action(e.funcId)}}},[a("v-list-item-content",[a("v-list-item-title",{domProps:{textContent:t._s(e.title)}})],1)],1)})),1)})),1)],1)},P=[],R=(a("b0c0"),function(t){for(var e=[],a=0,n=0;n<t.length;n++){var i=L(t[n][0],t[n][1],1.5,1.5);a+=i,e.push(i)}for(var o=0;o<e.length;o++)e[o]/=a;return e}),O=function(t){for(var e=[],a=-t;a<=t;a++)for(var n=-t;n<=t;n++)e.push([a,n]);return e},j=function(t,e){if(0==e instanceof Array)throw"nedd an array";var a=e.length,n=t.length;if(a<n)for(var i=0;i<Math.abs(a-n);i++){var o=Math.floor(Math.random()*a);e.push(e[o])}for(var r=0,s=0;s<n;s++)r+=e[s]*t[s];return parseInt(r)},L=function(t,e,a,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if(arguments.length<4)throw"参数长度至少4个！";for(var s=0;s<arguments.length;s++)if("number"!==typeof arguments[s])throw"请确保参数类型为数字！";return 1/(2*Math.PI*a*n*Math.sqrt(1-Math.pow(r,2)))*Math.exp(-1/(2*(1-Math.pow(r,2)))*(Math.pow(t-i,2)/Math.pow(a,2)-2*r*(t-i)*(e-o)/2*a*n+Math.pow(e-o,2)/Math.pow(n,2)))};function M(t,e){console.log("重设");var a=t.getContext("2d"),n=a.getImageData(0,0,t.width,t.height);a.clearRect(0,0,t.width,t.h);var i=new ImageData(n.data,n.width,n.height);return t.width=e.width,t.height=e.height,a.putImageData(e,0,0),i}function B(t,e){var a=t.getContext("2d"),n=a.getImageData(0,0,t.width,t.height),i=new String;switch(e){case 0:_(a,n),i="色彩反转";break;case 1:H(a,n),i="去色";break;case 2:V(a,n),i="浮雕";break;case 3:W(a,n),i="水平翻转";break;case 4:D(a,n),i="垂直翻转";break;case 5:E(a,n),i="黑白";break;case 6:N(a,n),i="高斯模糊";break;case 7:i="自由裁剪";break;case 8:i="缩放";break;case 9:i="旋转";break;default:console.log("未定义的功能");break}return{data:n,name:i}}function _(t,e){console.log("图片色彩反转");for(var a=e.data.length/4,n=0;n<a;n++)e.data[4*n]=255-e.data[4*n],e.data[4*n+1]=255-e.data[4*n+1],e.data[4*n+2]=255-e.data[4*n+2];t.putImageData(e,0,0)}function H(t,e){console.log("去色");for(var a=e.data.length/4,n=0;n<a;n++){var i=e.data[4*n],o=e.data[4*n+1],r=e.data[4*n+2],s=.3*i+.59*o+.11*r;e.data[4*n]=s,e.data[4*n+1]=s,e.data[4*n+2]=s}t.putImageData(e,0,0)}function V(t,e){console.log("浮雕");for(var a=e.data[0],n=e.data[1],i=e.data[2],o=e.data.length/4,r=0;r<o;r++){var s=e.data[4*r],c=e.data[4*r+1],l=e.data[4*r+2];e.data[4*r]+=128-a,e.data[4*r+1]+=128-n,e.data[4*r+2]+=128-i,a=s,n=c,i=l}t.putImageData(e,0,0)}function W(t,e){console.log("水平翻转");for(var a=e.width,n=e.height,i=4*a/2,o=0;o<n;o++)for(var r=o*a*4,s=(o+1)*a*4-4,c=s-i;r<=c;r+=4,s-=4){var l=e.data[r],u=e.data[r+1],d=e.data[r+2],h=e.data[r+3];e.data[r]=e.data[s],e.data[r+1]=e.data[s+1],e.data[r+2]=e.data[s+2],e.data[r+3]=e.data[s+3],e.data[s]=l,e.data[s+1]=u,e.data[s+2]=d,e.data[s+3]=h}t.putImageData(e,0,0)}function D(t,e){console.log("垂直翻转");for(var a=e.width,n=e.height,i=Math.floor(n/2),o=4*a,r=0;r<i;r++)for(var s=r*o,c=(n-r-1)*o;s<o*(r+1);s+=4,c+=4){var l=e.data[s],u=e.data[s+1],d=e.data[s+2],h=e.data[s+3];e.data[s]=e.data[c],e.data[s+1]=e.data[c+1],e.data[s+2]=e.data[c+2],e.data[s+3]=e.data[c+3],e.data[c]=l,e.data[c+1]=u,e.data[c+2]=d,e.data[c+3]=h}t.putImageData(e,0,0)}function E(t,e){console.log("黑白");for(var a=e.data.length,n=0;n<a;n+=4){var i=e.data[n],o=e.data[n+1],r=e.data[n+2],s=parseInt(.3*i+.59*o+.11*r)>=128?255:0;e.data[n]=s,e.data[n+1]=s,e.data[n+2]=s}t.putImageData(e,0,0)}function N(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;console.log("高斯模糊");for(var n=e.width,i=e.height,o=e.data,r=R(O(a)),s=0;s<i;s++)for(var c=0;c<n;c++){for(var l=[],u=[],d=[],h=[],m=-Math.abs(a);m<=Math.abs(a);m++)if(!(s+m<0||s+m>=i))for(var g=-Math.abs(a);g<=Math.abs(a);g++)if(!(c+g<0||c+g>=n)){var p=4*((s+m)*n+c+g);l.push(o[p]),u.push(o[p+1]),d.push(o[p+2]),h.push(o[p+3])}e.data[4*(s*n+c)]=j(r,l),e.data[4*(s*n+c)+1]=j(r,u),e.data[4*(s*n+c)+2]=j(r,d),e.data[4*(s*n+c)+3]=j(r,h)}t.putImageData(e,0,0)}var T={name:"Edits",computed:Object(r["a"])({},Object(u["e"])({opList:function(t){return t.opList},canvas:function(t){return t.canvas},cxt:function(t){return t.cxt},clipState:function(t){return t.clip.clipState},scaleState:function(t){return t.scale.scaleState},scaleRatio:function(t){return t.scale.scaleRatio},rotateState:function(t){return t.rotate.rotateState}})),data:function(){return{items:[{icon:"mdi-pencil",title:"基础编辑",items:[{title:"水平翻转",action:this.basicOP,funcId:3},{title:"垂直翻转",action:this.basicOP,funcId:4},{title:"自由裁剪",action:this.clipping,funcId:7},{title:"缩放",action:this.scaling,funcId:8},{title:"旋转",action:this.rotating,funcId:9}]},{icon:"mdi-pencil",title:"风格编辑",items:[{title:"色彩反转",action:this.basicOP,funcId:0},{title:"去色",action:this.basicOP,funcId:1},{title:"浮雕",action:this.basicOP,funcId:2},{title:"黑白",action:this.basicOP,funcId:5},{title:"高斯模糊",action:this.basicOP,funcId:6}]}],opCheckList:[{op:this.getClipState,name:"自由裁剪",todo:this.endClip,param:null},{op:this.getScaleState,name:"缩放",todo:this.endScaling,param:0},{op:this.getRotateState,name:"旋转",todo:this.endRotating,param:0}]}},methods:Object(r["a"])({},Object(u["c"])("clip",["getClipState"]),{},Object(u["c"])("scale",["getScaleState"]),{},Object(u["c"])("rotate",["getRotateState"]),{},Object(u["b"])("clip",["initialClip","endClip"]),{},Object(u["b"])("scale",["doScaling","endScaling"]),{},Object(u["b"])("rotate",["doRotating","endRotating"]),{preCheck:function(){for(var t=0,e=this.opCheckList.length;t<e;t++){var a=this.opCheckList[t];if(a.op()){var n=a.name+"结果尚未保存，是否放弃？";return confirm(n)&&a.todo(a.param),!1}}return!0},basicOP:function(t){this.preCheck()&&(this.opList.removeBackPart(),this.opList.push(B(this.canvas,t)),console.log("opList: ",this.opList))},clipping:function(t){this.preCheck()&&this.initialClip(t)},scaling:function(t){this.preCheck()&&this.doScaling(t)},rotating:function(t){this.preCheck()&&this.doRotating(t)}})},X=T,Y=a("8860"),z=a("56b0"),A=a("da13"),F=a("5d23"),U=Object(m["a"])(X,C,P,!1,null,null,null),$=U.exports;p()(U,{VContainer:x["a"],VList:Y["a"],VListGroup:z["a"],VListItem:A["a"],VListItemContent:F["a"],VListItemTitle:F["b"]});var G=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-container",{attrs:{fluid:""}},[a("v-row",[a("v-col",{attrs:{cols:"12"}},[a("v-row",{attrs:{align:"center",justify:"center"}},[a("v-btn-toggle",{attrs:{dense:"",borderless:"","background-color":"white accent-3"}},[a("v-btn",{on:{click:t.undo}},[a("v-icon",{attrs:{dark:""}},[t._v("mdi-undo")])],1),a("v-btn",{on:{click:t.redo}},[a("v-icon",{attrs:{dark:""}},[t._v("mdi-redo")])],1),a("v-btn",{on:{click:t.resetToOrigin}},[a("v-icon",{attrs:{dark:""}},[t._v("mdi-restore")])],1)],1)],1)],1)],1),a("v-subheader",[t._v("历史记录")]),a("v-list",{attrs:{shaped:""}},[a("v-list-item-group",{attrs:{color:"primary"},model:{value:t.curState,callback:function(e){t.curState=e},expression:"curState"}},t._l(this.opList.element,(function(e,n){return a("v-list-item",{key:n,on:{click:function(e){return t.change(n)}}},[a("v-list-item-content",[a("v-list-item-title",{domProps:{textContent:t._s(e.name)}})],1)],1)})),1)],1)],1)},J=[],q={name:"history",data:function(){return{curState:0,opCheckList:[{op:this.getClipState,name:"自由裁剪",todo:this.endClip,param:null},{op:this.getScaleState,name:"缩放",todo:this.endScaling,param:0}]}},watch:{listenList:{handler:function(t){this.curState=t}}},computed:Object(r["a"])({},Object(u["e"])(["opList","canvas","cxt","originImgInfo"]),{listenList:function(){return this.opList.getNowIndex()}}),methods:Object(r["a"])({},Object(u["c"])("clip",["getClipState"]),{},Object(u["c"])("scale",["getScaleState"]),{},Object(u["d"])(["setToOrigin"]),{},Object(u["d"])("clip",["endClip"]),{},Object(u["b"])("scale",["endScaling"]),{preCheck:function(){for(var t=0,e=this.opCheckList.length;t<e;t++){var a=this.opCheckList[t];if(a.op()){var n=a.name+"结果尚未保存，是否放弃？";if(!confirm(n))return!1;a.todo(a.param)}}return!0},resetToOrigin:function(){confirm("您点击了恢复原图，该操作不可撤销，是否确认？")&&(this.setToOrigin(),this.opList.reset(),console.log("opList:",this.opList.size()))},undo:function(){if(this.preCheck())if(0!=this.opList.getNowIndex()){console.log("undo canvas ",this.canvas);var t=this.opList.getNowAndForward();0==this.opList.getNowIndex()?this.setToOrigin():M(this.canvas,t.data),console.log("opList:",this.opList.size())}else alert("没有可以撤销的操作了")},redo:function(){if(this.preCheck())if(this.opList.getNowIndex()!=this.opList.size()-1){var t=this.opList.getNowAndBackward(),e=t.data;M(this.canvas,e),console.log("opList:",this.opList.size())}else alert("没有可以重做的操作了")},change:function(t){if(this.preCheck()){var e=this.opList.getAndSetNow(t);if(void 0!=e){console.log("history i: ",t);var a=e.data;M(this.canvas,a)}else console.log("非法操作")}}})},K=q,Q=a("a609"),Z=a("1baa"),tt=a("e0c7"),et=Object(m["a"])(K,G,J,!1,null,null,null),at=et.exports;p()(et,{VBtn:v["a"],VBtnToggle:Q["a"],VCol:f["a"],VContainer:x["a"],VIcon:b["a"],VList:Y["a"],VListItem:A["a"],VListItemContent:F["a"],VListItemGroup:Z["a"],VListItemTitle:F["b"],VRow:w["a"],VSubheader:tt["a"]});var nt={props:{source:String},data:function(){return{drawer:null,drawerRight:null,left:!1,right:!1,barColor:"black",originImgData:void 0}},computed:Object(r["a"])({},Object(u["e"])(["opList","canvas","cxt"])),methods:{canvasReady:function(){var t=this.cxt.getImageData(0,0,this.canvas.width,this.canvas.height);this.originImgData=new ImageData(t.data,t.width,t.height),this.opList.push({data:this.originImgData,name:"原图"}),console.log("原图数据解析完成")}},components:{midBlock:y,Edits:$,history:at}},it=nt,ot=a("7496"),rt=a("40dc"),st=a("5bc1"),ct=a("a75b"),lt=a("553a"),ut=a("f774"),dt=a("2fa4"),ht=a("2a7f"),mt=Object(m["a"])(it,i,o,!1,null,null,null),gt=mt.exports;p()(mt,{VApp:ot["a"],VAppBar:rt["a"],VAppBarNavIcon:st["a"],VContainer:x["a"],VContent:ct["a"],VFooter:lt["a"],VList:Y["a"],VListItem:A["a"],VNavigationDrawer:ut["a"],VRow:w["a"],VSpacer:dt["a"],VToolbarTitle:ht["a"]});var pt=a("f309");n["a"].use(pt["a"]);var vt=new pt["a"]({}),ft={namespaced:!0,state:{clipState:!1,afterValidClick:!1,funcId:null,boxParams:{X:null,Y:null,W:null,H:null,currentX:null,currentY:null,kind:null},boxStyle:{position:"absolute",border:"1px solid black",height:"0",width:"0",left:"0",top:"0"}},getters:{getClipState:function(t){return t.clipState}},mutations:{mouseDownEvent:function(t,e){!t.clipState||"box"!==e.target.parentNode.id&&"box"!==e.target.id||(console.log("点击落在截图框内",e.target.parentNode.id,e.target.id,t.boxParams),t.afterValidClick=!0,t.boxParams.currentX=e.clientX,t.boxParams.currentY=e.clientY,t.boxParams.kind=e.target.id)},setBoxParams:function(t,e){t.boxParams.X=e.X,t.boxParams.Y=e.Y,t.boxParams.W=e.W,t.boxParams.H=e.H},resetAll:function(t){t.afterValidClick=!1,t.boxParams.X=null,t.boxParams.Y=null,t.boxParams.W=null,t.boxParams.H=null,t.boxParams.currentX=null,t.boxParams.currentY=null,t.boxParams.kind=null}},actions:{initialClip:function(t,e){var a=t.dispatch,n=t.state,i=t.rootState,o=t.commit;console.log("裁切初始化"),n.funcId=e,n.clipState=!0,i.showBottomBar=!1,o("resetAll"),i.clipMask.width=i.canvas.width,i.clipMask.height=i.canvas.height,i.clipFrame.style.width=i.canvas.width+"px",i.clipFrame.style.height=i.canvas.height+"px",console.log(i.clipFrame);var r=Math.min(i.canvas.width,i.canvas.height),s=(i.canvas.width-r)/2,c=(i.canvas.height-r)/2;o("setBoxParams",{X:s,Y:c,W:r,H:r}),n.boxStyle.height=n.boxStyle.width=r+"px",n.boxStyle.left=s+"px",n.boxStyle.top=c+"px",a("drawTrim")},mouseMoveEvent:function(t,e){var a=t.dispatch,n=t.state,i=t.rootState;if(n.afterValidClick&&n.clipState){console.log("mouseMoveEvent",e);var o=e.clientX,r=e.clientY,s=o-n.boxParams.currentX,c=r-n.boxParams.currentY,l=n.boxParams.X,u=n.boxParams.Y,d=n.boxParams.W,h=n.boxParams.H,m=[0,i.canvas.width],g=[0,i.canvas.height],p=[0,i.canvas.width],v=[0,i.canvas.height];"UC"===n.boxParams.kind?(u+=c,h-=c,g[1]=v[1]=n.boxParams.H+n.boxParams.Y):"LC"===n.boxParams.kind?(l+=s,d-=s,m[1]=p[1]=n.boxParams.W+n.boxParams.X):"RC"===n.boxParams.kind?(d+=s,m[0]=n.boxParams.X,p[1]-=n.boxParams.X):"DC"===n.boxParams.kind?(h+=c,g[0]=n.boxParams.Y,v[1]-=n.boxParams.Y):"LU"===n.boxParams.kind?(l+=s,d-=s,u+=c,h-=c,m[1]=p[1]=n.boxParams.W+n.boxParams.X,g[1]=v[1]=n.boxParams.H+n.boxParams.Y):"RU"===n.boxParams.kind?(u+=c,h-=c,d+=s,m[0]=n.boxParams.X,p[1]-=n.boxParams.X,g[1]=v[1]=n.boxParams.H+n.boxParams.Y):"LD"===n.boxParams.kind?(l+=s,d-=s,h+=c,m[1]=p[1]=n.boxParams.W+n.boxParams.X,g[0]=n.boxParams.Y,v[1]-=n.boxParams.Y):"RD"===n.boxParams.kind?(d+=s,h+=c,m[0]=n.boxParams.X,p[1]-=n.boxParams.X,g[0]=n.boxParams.Y,v[1]-=n.boxParams.Y):(l+=s,u+=c,m[1]-=n.boxParams.W,g[1]-=n.boxParams.H),n.boxStyle.top=Math.max(g[0],Math.min(g[1],u))+"px",n.boxStyle.left=Math.max(m[0],Math.min(m[1],l))+"px",n.boxStyle.height=Math.max(v[0],Math.min(v[1],h))+"px",n.boxStyle.width=Math.max(p[0],Math.min(p[1],d))+"px",console.log(n.boxParams.kind,n.boxStyle.left,n.boxStyle.top,n.boxStyle.width,n.boxStyle.height),a("drawTrim")}},mouseReleaseEvent:function(t){var e=t.state,a=t.commit;e.afterValidClick&&e.clipState&&(e.afterValidClick=!1,a("setBoxParams",{X:parseInt(e.boxStyle.left),Y:parseInt(e.boxStyle.top),W:parseInt(e.boxStyle.width),H:parseInt(e.boxStyle.height)}))},drawTrim:function(t){var e=t.state,a=t.rootState;console.log("drawTrim"),a.maskCxt.clearRect(0,0,a.clipMask.width,a.clipMask.height),a.maskCxt.save(),a.maskCxt.fillStyle="rgba(166, 166, 166, 0.6)",a.maskCxt.fillRect(0,0,a.clipMask.width,a.clipMask.height),a.maskCxt.globalCompositeOperation="source-atop",a.maskCxt.clearRect(parseInt(e.boxStyle.left),parseInt(e.boxStyle.top),parseInt(e.boxStyle.width),parseInt(e.boxStyle.height)),a.maskCxt.restore()},endClip:function(t,e){return Object(l["a"])(regeneratorRuntime.mark((function a(){var n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=t.rootState,i=t.dispatch,a.next=3,i("exit",e);case 3:console.log("退出裁切"),n.showBottomBar=!0;case 5:case"end":return a.stop()}}),a)})))()},exit:function(t,e){var a=t.state,n=t.rootState,i=t.commit;if(0!=e){var o=n.cxt.getImageData(a.boxParams.X,a.boxParams.Y,a.boxParams.W,a.boxParams.H);return console.log(o),n.cxt.clearRect(0,0,n.canvas.width,n.canvas.height),n.maskCxt.clearRect(0,0,n.clipMask.width,n.clipMask.height),n.canvas.width=a.boxParams.W,n.canvas.height=a.boxParams.H,n.cxt.putImageData(o,0,0),a.clipState=!1,console.log("裁切完成"),new Promise((function(t){n.opList.removeBackPart(),n.opList.push(B(n.canvas,a.funcId)),console.log("历史记录已更新"),t()}))}n.maskCxt.clearRect(0,0,n.clipMask.width,n.clipMask.height),i("resetAll"),a.clipState=!1,console.log("取消裁切")}}},xt=ft,bt={namespaced:!0,state:{scaleState:!1,scaleRatio:100,curImg:null,imgW:0,imgH:0,max:null,funcId:null},getters:{getScaleState:function(t){return t.scaleState}},mutations:{setScaleRatio:function(t,e){t.scaleRatio=e}},actions:{setImgByCanvas:function(t){var e=t.state,a=t.rootState;return new Promise((function(t){e.imgW=a.canvas.width,e.imgH=a.canvas.height,e.curImg=new Image,e.curImg.crossOrigin="",e.curImg.src=a.canvas.toDataURL(),e.curImg.onload=function(){t()},e.curImg.complete&&t()}))},doScaling:function(t,e){return Object(l["a"])(regeneratorRuntime.mark((function a(){var n,i,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=t.state,i=t.rootState,o=t.dispatch,n.funcId=e,i.showBottomBar=!1,a.next=5,o("setImgByCanvas");case 5:n.max=200*i.edgeH/n.imgH,n.scaleRatio=100,i.canvas.width=i.edgeW,i.canvas.height=i.edgeH,i.cxt.drawImage(n.curImg,(i.canvas.width-n.imgW)/2,(i.canvas.height-n.imgH)/2),n.scaleState=!0,console.log("缩放初始化完成");case 12:case"end":return a.stop()}}),a)})))()},reScale:function(t){var e=t.state,a=t.rootState;if(e.scaleState){console.log("重新缩放");var n=e.scaleRatio/100;a.cxt.clearRect(0,0,a.canvas.width,a.canvas.height),a.cxt.save(),a.cxt.translate(a.canvas.width/2,a.canvas.height/2),a.cxt.scale(n,n),a.cxt.drawImage(e.curImg,-e.imgW/2,-e.imgH/2),a.cxt.restore()}},endScaling:function(t,e){return Object(l["a"])(regeneratorRuntime.mark((function a(){var n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=t.rootState,i=t.dispatch,a.next=3,i("exit",e);case 3:console.log("退出缩放"),n.showBottomBar=!0;case 5:case"end":return a.stop()}}),a)})))()},exit:function(t,e){var a=t.state,n=t.rootState;if(0!=e){console.log("确认缩放",e);var i=a.scaleRatio/100;n.cxt.clearRect(0,0,n.canvas.width,n.canvas.height);var o,r,s=0,c=0,l=a.imgW*i,u=a.imgH*i;return l<=n.edgeW&&u<=n.edgeH?(n.canvas.width=l,n.canvas.height=u,o=a.imgW,r=a.imgH):(s=(l-n.edgeW)/(2*i),c=(u-n.edgeH)/(2*i),o=n.edgeW/i,r=n.edgeH/i),n.cxt.drawImage(a.curImg,s,c,o,r,0,0,n.canvas.width,n.canvas.height),new Promise((function(t){n.opList.removeBackPart(),n.opList.push(B(n.canvas,a.funcId)),console.log("历史记录已更新"),a.scaleState=!1,t()}))}console.log("取消缩放",e),n.cxt.clearRect(0,0,n.canvas.width,n.canvas.height),n.canvas.width=a.imgW,n.canvas.height=a.imgH,n.cxt.drawImage(a.curImg,0,0),a.scaleState=!1}}},wt=bt,St={namespaced:!0,state:{rotateState:!1,theta:0,curImg:null,imgW:0,imgH:0,funcId:null},getters:{getRotateState:function(t){return t.rotateState}},mutations:{setTheta:function(t,e){t.theta=e}},actions:{setImgByCanvas:function(t){var e=t.state,a=t.rootState;return new Promise((function(t){e.imgW=a.canvas.width,e.imgH=a.canvas.height,e.curImg=new Image,e.curImg.crossOrigin="",e.curImg.src=a.canvas.toDataURL(),e.curImg.onload=function(){t()},e.curImg.complete&&t()}))},doRotating:function(t,e){return Object(l["a"])(regeneratorRuntime.mark((function a(){var n,i,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=t.state,i=t.rootState,o=t.dispatch,n.funcId=e,i.showBottomBar=!1,a.next=5,o("setImgByCanvas");case 5:n.theta=0,n.rotateState=!0,console.log("旋转初始化完成");case 8:case"end":return a.stop()}}),a)})))()},reRotate:function(t){var e=t.state,a=t.rootState;e.rotateState&&(console.log("重新旋转"),a.cxt.clearRect(0,0,a.canvas.width,a.canvas.height),a.cxt.save(),a.cxt.translate(a.canvas.width/2,a.canvas.height/2),a.cxt.rotate(e.theta*Math.PI/180),a.cxt.drawImage(e.curImg,-e.imgW/2,-e.imgH/2),a.cxt.restore())},endRotating:function(t,e){return Object(l["a"])(regeneratorRuntime.mark((function a(){var n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=t.rootState,i=t.dispatch,a.next=3,i("exit",e);case 3:console.log("退出旋转"),n.showBottomBar=!0;case 5:case"end":return a.stop()}}),a)})))()},exit:function(t,e){var a=t.state,n=t.rootState;if(0!=e)return console.log("确认旋转",e),new Promise((function(t){n.opList.removeBackPart(),n.opList.push(B(n.canvas,a.funcId)),console.log("历史记录已更新"),a.rotateState=!1,t()}));console.log("取消旋转",e),n.cxt.clearRect(0,0,n.canvas.width,n.canvas.height),n.canvas.width=a.imgW,n.canvas.height=a.imgH,n.cxt.drawImage(a.curImg,0,0),a.rotateState=!1}}},kt=St,It=(a("a434"),a("d4ec")),yt=a("bee2"),Ct=function(){function t(e){Object(It["a"])(this,t),this.element=[],this.nowIndex=-1,this.cap=e}return Object(yt["a"])(t,[{key:"getNowIndex",value:function(){return this.nowIndex}},{key:"getNowAndForward",value:function(){if(!(this.nowIndex<0))return this.nowIndex--,this.element[this.nowIndex]}},{key:"getNowAndBackward",value:function(){if(!(this.nowIndex<0))return this.nowIndex++,this.element[this.nowIndex]}},{key:"getAndSetNow",value:function(t){if(!(t<0||t>this.size()))return this.nowIndex=t,this.element[this.nowIndex]}},{key:"reset",value:function(){this.element.splice(1),this.nowIndex=0}},{key:"removeBackPart",value:function(){-1!=this.nowIndex&&this.element.splice(this.nowIndex+1)}},{key:"at",value:function(t){if(!(t<0||t>this.element.length))return this.element[t];console.log("Invalid index")}},{key:"push",value:function(t){void 0!=t?(this.element.length==this.cap&&(this.element.shift(),console.log("超过容量，挤掉栈底"),this.nowIndex--),this.element.push(t),this.nowIndex++):console.log("push undefined.")}},{key:"pop",value:function(){if(0!=this.element.length)return this.nowIndex--,this.element.pop()}},{key:"back",value:function(){return this.element[this.element.length-1]}},{key:"size",value:function(){return this.element.length}},{key:"empty",value:function(){return 0==this.element.length}},{key:"clear",value:function(){this.element.splice(0,this.element.length),this.nowIndex=-1}}]),t}();n["a"].use(u["a"]);var Pt=new u["a"].Store({modules:{clip:xt,scale:wt,rotate:kt},state:{opList:new Ct(10),canvas:null,cxt:null,clipMask:null,maskCxt:null,clipFrame:null,originImgInfo:null,edgeW:null,edgeH:null,showBottomBar:!0},getters:{},mutations:{setCanvas:function(t,e){t.canvas=e.canvas,t.cxt=e.cxt,t.clipMask=e.clipMask,t.maskCxt=e.maskCxt,t.clipFrame=e.clipFrame},setEdge:function(t,e){t.edgeH=e.edgeH,t.edgeW=e.edgeW},storeOriginImgInfo:function(t){t.originImgInfo=t.cxt.getImageData(0,0,t.canvas.width,t.canvas.height)},setToOrigin:function(t){t.cxt.clearRect(0,0,t.canvas.width,t.canvas.height),t.canvas.width=t.originImgInfo.width,t.canvas.height=t.originImgInfo.height,t.cxt.putImageData(t.originImgInfo,0,0)}},actions:{}}),Rt=Pt;n["a"].config.productionTip=!1,new n["a"]({el:"#app",store:Rt,vuetify:vt,render:function(t){return t(gt)}})},a76c:function(t,e,a){t.exports=a.p+"img/default1.3848437a.png"},b977:function(t,e,a){t.exports=a.p+"img/default2.879a0139.png"},c039:function(t,e,a){t.exports=a.p+"img/default3.62d0c72d.png"}});
//# sourceMappingURL=app.b6500169.js.map