(function(t){function e(e){for(var i,r,s=e[0],c=e[1],l=e[2],d=0,h=[];d<s.length;d++)r=s[d],Object.prototype.hasOwnProperty.call(n,r)&&n[r]&&h.push(n[r][0]),n[r]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);u&&u(e);while(h.length)h.shift()();return o.push.apply(o,l||[]),a()}function a(){for(var t,e=0;e<o.length;e++){for(var a=o[e],i=!0,s=1;s<a.length;s++){var c=a[s];0!==n[c]&&(i=!1)}i&&(o.splice(e--,1),t=r(r.s=a[0]))}return t}var i={},n={app:0},o=[];function r(e){if(i[e])return i[e].exports;var a=i[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=i,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(a,i,function(e){return t[e]}.bind(null,i));return a},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var l=0;l<s.length;l++)e(s[l]);var u=c;o.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"56d7":function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var i=a("2b0e"),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-app",{attrs:{id:"inspire"}},[a("v-app-bar",{attrs:{app:"","clipped-right":"","clipped-left":"",color:t.barColor,dark:""}},[a("v-app-bar-nav-icon",{on:{click:function(e){e.stopPropagation(),t.drawer=!t.drawer}}}),a("v-toolbar-title",[t._v("OnlinePS")]),a("v-spacer"),a("v-app-bar-nav-icon",{on:{click:function(e){e.stopPropagation(),t.drawerRight=!t.drawerRight}}})],1),a("v-navigation-drawer",{attrs:{app:"",width:"auto",right:"",clipped:""},model:{value:t.drawerRight,callback:function(e){t.drawerRight=e},expression:"drawerRight"}},[a("v-list",{attrs:{dense:""}},[a("v-list-item",[a("rightSidebar")],1)],1)],1),a("v-navigation-drawer",{attrs:{app:"",width:"auto",clipped:""},model:{value:t.drawer,callback:function(e){t.drawer=e},expression:"drawer"}},[a("v-list",{attrs:{dense:""}},[a("v-list-item",[a("leftSidebar")],1)],1)],1),a("v-navigation-drawer",{attrs:{fixed:"",temporary:""},model:{value:t.left,callback:function(e){t.left=e},expression:"left"}}),a("v-content",[a("v-container",{staticClass:"fill-height",attrs:{fluid:""}},[a("v-row",{attrs:{justify:"center",align:"center"}},[a("midBlock")],1)],1)],1),a("v-navigation-drawer",{attrs:{fixed:"",right:"",temporary:""},model:{value:t.right,callback:function(e){t.right=e},expression:"right"}}),a("v-footer",{staticClass:"white--text",attrs:{app:"",color:t.barColor}},[a("span",[t._v("SETeam06")]),a("v-spacer"),a("span",[t._v("© 2020")])],1)],1)},o=[],r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-container",{attrs:{fluid:""},on:{mousedown:function(e){return t.mouseDownEvent(e)},mousemove:function(e){return t.mouseMoveEvent(e)},mouseup:function(e){return t.mouseReleaseEvent(e)}}},[i("v-row",[i("v-col",{attrs:{cols:"12"}},[i("v-row",{directives:[{name:"show",rawName:"v-show",value:t.scaleState,expression:"scaleState"}],attrs:{align:"stretch",justify:"center"}},[i("v-col",{attrs:{cols:"6"}},[i("v-slider",{staticClass:"align-center",attrs:{max:t.max,min:"0","thumb-label":"always"},scopedSlots:t._u([{key:"thumb-label",fn:function(e){var a=e.value;return[t._v(" "+t._s(a/100)+"x ")]}}]),model:{value:t.editScale,callback:function(e){t.editScale=e},expression:"editScale"}})],1),i("v-btn",{staticClass:"mx-2",attrs:{outlined:"",fab:"",small:"",color:"indigo"},on:{click:function(e){return t.endScaling(1)}}},[i("v-icon",[t._v("mdi-check")])],1),i("v-btn",{staticClass:"mx-2",attrs:{outlined:"",fab:"",small:"",color:"indigo"},on:{click:function(e){return t.endScaling(0)}}},[i("v-icon",[t._v("mdi-close")])],1)],1),i("v-row",{directives:[{name:"show",rawName:"v-show",value:t.rotateState,expression:"rotateState"}],attrs:{align:"stretch",justify:"center"}},[i("v-col",{attrs:{cols:"6"}},[i("v-slider",{staticClass:"align-left",attrs:{max:360,min:"0","thumb-label":"always"},scopedSlots:t._u([{key:"thumb-label",fn:function(e){var a=e.value;return[t._v(" "+t._s(a)+"° ")]}}]),model:{value:t.editRotate,callback:function(e){t.editRotate=e},expression:"editRotate"}})],1),i("v-btn",{staticClass:"mx-2",attrs:{outlined:"",fab:"",small:"",color:"indigo"},on:{click:function(e){return t.endRotating(1)}}},[i("v-icon",[t._v("mdi-check")])],1),i("v-btn",{staticClass:"mx-2",attrs:{outlined:"",fab:"",small:"",color:"indigo"},on:{click:function(e){return t.endRotating(0)}}},[i("v-icon",[t._v("mdi-close")])],1)],1),i("v-row",{directives:[{name:"show",rawName:"v-show",value:t.clipState,expression:"clipState"}],attrs:{align:"stretch",justify:"center"}},[i("v-btn",{staticClass:"mx-2 my-1",attrs:{outlined:"",fab:"",small:"",color:"indigo"},on:{click:function(e){return t.endClip(1)}}},[i("v-icon",[t._v("mdi-check")])],1),i("v-btn",{staticClass:"mx-2 my-1",attrs:{outlined:"",fab:"",small:"",color:"indigo"},on:{click:function(e){return t.endClip(0)}}},[i("v-icon",[t._v("mdi-close")])],1)],1),i("v-row",{staticClass:"grey lighten-5",attrs:{id:"canvasWrapper",align:"center",justify:"center"}},[i("img",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{crossorigin:"",id:"myImg1",src:a("a76c")}}),i("img",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{crossorigin:"",id:"myImg2",src:a("b977")}}),i("img",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{crossorigin:"",id:"myImg3",src:a("c039")}}),i("div",{directives:[{name:"show",rawName:"v-show",value:t.clipState,expression:"clipState"}],staticStyle:{position:"absolute","z-index":"1"},attrs:{id:"clipFrame"}},[i("div",{staticStyle:{cursor:"move"},style:[t.boxStyle],attrs:{id:"box"}},[i("div",{staticStyle:{left:"-3px",top:"-3px",cursor:"nw-resize"},style:[t.dotStyle],attrs:{id:"LU"}}),i("div",{staticStyle:{left:"-3px",bottom:"-3px",cursor:"sw-resize"},style:[t.dotStyle],attrs:{id:"LD"}}),i("div",{staticStyle:{right:"-3px",top:"-3px",cursor:"ne-resize"},style:[t.dotStyle],attrs:{id:"RU"}}),i("div",{staticStyle:{right:"-3px",bottom:"-3px",cursor:"se-resize"},style:[t.dotStyle],attrs:{id:"RD"}}),i("div",{staticStyle:{top:"-3px",left:"50%","margin-left":"-3px",cursor:"n-resize"},style:[t.dotStyle],attrs:{id:"UC"}}),i("div",{staticStyle:{bottom:"-3px",left:"50%","margin-left":"-3px",cursor:"s-resize"},style:[t.dotStyle],attrs:{id:"DC"}}),i("div",{staticStyle:{right:"-3px",top:"50%","margin-top":"-3px",cursor:"e-resize"},style:[t.dotStyle],attrs:{id:"RC"}}),i("div",{staticStyle:{left:"-3px",top:"50%","margin-top":"-3px",cursor:"w-resize"},style:[t.dotStyle],attrs:{id:"LC"}})])]),i("canvas",{staticStyle:{position:"absolute"},attrs:{id:"myCanvas"}}),i("canvas",{staticStyle:{position:"absolute"},attrs:{id:"clipMask"}})]),i("v-row",{directives:[{name:"show",rawName:"v-show",value:t.showLowerSide,expression:"showLowerSide"}],attrs:{id:"lowerSide",align:"stretch",justify:"center"}},[i("v-col",{attrs:{cols:"5"}},[t.hackReset?i("v-select",{attrs:{label:"选择图片",items:t.defaultImgs,"item-text":"name","item-value":"value",outlined:""},on:{change:t.showWarningMsg},model:{value:t.choice,callback:function(e){t.choice=e},expression:"choice"}}):t._e()],1),i("input",{staticStyle:{display:"none"},attrs:{id:"uploadImg",type:"file"},on:{change:t.getUserImg}}),i("v-btn",{staticClass:"ma-4",on:{click:t.downloadImage}},[t._v(" 保存图片 ")])],1)],1)],1)],1)},s=[],c=(a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("96cf"),a("1da1")),l=a("5530"),u=a("2f62"),d={name:"midBlock",data:function(){return{choice:1,lastChoice:1,confirmChange:!0,defaultImgs:[{name:"花卉",value:1},{name:"自然",value:2},{name:"人像",value:3},{name:"自定义",value:0}],firstCallHandler:!0,hackReset:!0,dotStyle:{position:"absolute",width:"6px",height:"6px",border:"1px solid #000",background:"white",overflow:"hidden"}}},watch:{choice:{handler:function(t,e){var a=this;console.log("监听到改变: ",t,e,"用户是否确认改变: ",this.confirmChange),this.lastChoice=e,this.confirmChange?this.changeImg(t):this.firstCallHandler?(this.firstCallHandler=!1,this.choice=this.lastChoice,this.hackReset=!1,this.$nextTick((function(){a.hackReset=!0}))):this.firstCallHandler=!0}},editScale:{handler:function(){this.reScale()}},editRotate:{handler:function(){this.reRotate()}}},computed:Object(l["a"])({},Object(u["e"])(["opList","canvas","cxt","clipMask","maskCxt","edgeW","edgeH","showLowerSide"]),{},Object(u["e"])("clip",["clipState","boxStyle","boxStyle"]),{},Object(u["e"])("scale",["scaleState","scaleRatio","max"]),{},Object(u["e"])("rotate",["rotateState","theta"]),{editScale:{get:function(){return this.scaleRatio},set:function(t){this.setScaleRatio(t)}},editRotate:{get:function(){return this.theta},set:function(t){this.setTheta(t)}}}),mounted:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){var e,a,i,n,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(console.log("进入图片预设函数"),e=document.getElementById("canvasWrapper"),a=document.getElementsByClassName("v-content__wrap"),e.style.height=a[0].clientHeight-170+"px",this.setEdge({edgeH:a[0].clientHeight-220,edgeW:a[0].clientWidth}),i=document.getElementById("myCanvas"),n=document.getElementById("clipMask"),o=document.getElementById("clipFrame"),!i.getContext){t.next=19;break}return console.log("浏览器支持Canvas!"),this.storeInterfaces({canvas:i,clipMask:n,clipFrame:o}),console.log("画布与接口初始化完成"),t.next=14,this.fillCanvas(1,this.callback);case 14:console.log("画布准备完毕",this.canvas,this.cxt),this.storeOriginImgInfo(),console.log("初始化完成",this.opList),t.next=20;break;case 19:alert("抱歉，您的浏览器不支持Canvas，请更新版本后重试");case 20:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),methods:Object(l["a"])({},Object(u["d"])(["storeInterfaces","storeOriginImgInfo","setEdge"]),{},Object(u["d"])("clip",["mouseDownEvent"]),{},Object(u["d"])("scale",["setScaleRatio"]),{},Object(u["d"])("rotate",["setTheta"]),{},Object(u["b"])("clip",["mouseMoveEvent","mouseReleaseEvent","endClip"]),{},Object(u["b"])("scale",["reScale","endScaling"]),{},Object(u["b"])("rotate",["reRotate","endRotating"]),{downloadImage:function(){console.log("图片下载到本地");var t=document.createElement("a");this.canvas.toBlob((function(e){t.download="imgFile.jpg",t.href=URL.createObjectURL(e),t.click()}),"image/jpeg",1)},getUserImg:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=document.getElementById("uploadImg"),0!=e.files.length){t.next=4;break}return console.log("没有可用文件"),t.abrupt("return");case 4:return a=void 0,t.next=7,this.getRawImgData(e.files[0]).then((function(t){a=t}));case 7:this.changeImg(a);case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),showWarningMsg:function(){this.confirmChange=confirm("更改图片后，当前画布上的图片将会丢失，是否确认？")},getRawImgData:function(t){return new Promise((function(e){var a=new FileReader;a.readAsDataURL(t),a.onload=function(t){e(t.target.result)}}))},changeImg:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.opList.clear(),0==e&&document.getElementById("uploadImg").click(),t.next=4,this.fillCanvas(e,this.callback);case 4:console.log("画布准备完毕",this.canvas,this.cxt),this.storeOriginImgInfo();case 6:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),fillCanvas:function(t,e){return new Promise((function(a){var i=void 0;1==t||2==t||3==t?i=document.getElementById("myImg"+t):(i=new Image,i.crossOrigin="",i.src=t),i.onload=function(){console.log("调用onload"),e(i),a()},i.complete&&(console.log("调用complete"),e(i),a())}))},callback:function(t){console.log("清空画布"),this.cxt.clearRect(0,0,this.canvas.offsetWidth,this.canvas.offsetHeight),this.canvas.width=Math.min(this.edgeW,t.width),this.canvas.height=Math.min(this.edgeH,t.height);var e=this.canvas.width/t.width,a=this.canvas.height/t.height,i=e<a?e:a;i=Math.min(1,i);var n=t.width*i,o=t.height*i;this.canvas.width=n,this.canvas.height=o,this.cxt.drawImage(t,0,0,n,o),console.log("画布绘制完成")}})},h=d,m=a("2877"),g=a("6544"),p=a.n(g),v=a("8336"),f=a("62ad"),b=a("a523"),x=a("132d"),w=a("0fd9"),S=a("b974"),k=a("ba0d"),I=Object(m["a"])(h,r,s,!1,null,null,null),y=I.exports;p()(I,{VBtn:v["a"],VCol:f["a"],VContainer:b["a"],VIcon:x["a"],VRow:w["a"],VSelect:S["a"],VSlider:k["a"]});var P=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-container",{attrs:{fluid:""}},[a("v-list",t._l(t.items,(function(e){return a("v-list-group",{key:e.title,attrs:{"prepend-icon":e.icon,"no-action":""},scopedSlots:t._u([{key:"activator",fn:function(){return[a("v-list-item-content",[a("v-list-item-title",{domProps:{textContent:t._s(e.title)}})],1)]},proxy:!0}],null,!0)},t._l(e.items,(function(e){return a("v-list-item",{key:e.title,on:{click:function(t){return e.action(e.funcId)}}},[a("v-list-item-content",[a("v-list-item-title",{domProps:{textContent:t._s(e.title)}})],1)],1)})),1)})),1)],1)},C=[],R=(a("b0c0"),function(t){for(var e=[],a=0,i=0;i<t.length;i++){var n=j(t[i][0],t[i][1],1.5,1.5);a+=n,e.push(n)}for(var o=0;o<e.length;o++)e[o]/=a;return e}),O=function(t){for(var e=[],a=-t;a<=t;a++)for(var i=-t;i<=t;i++)e.push([a,i]);return e},L=function(t,e){if(0==e instanceof Array)throw"nedd an array";var a=e.length,i=t.length;if(a<i)for(var n=0;n<Math.abs(a-i);n++){var o=Math.floor(Math.random()*a);e.push(e[o])}for(var r=0,s=0;s<i;s++)r+=e[s]*t[s];return parseInt(r)},j=function(t,e,a,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if(arguments.length<4)throw"参数长度至少4个！";for(var s=0;s<arguments.length;s++)if("number"!==typeof arguments[s])throw"请确保参数类型为数字！";return 1/(2*Math.PI*a*i*Math.sqrt(1-Math.pow(r,2)))*Math.exp(-1/(2*(1-Math.pow(r,2)))*(Math.pow(t-n,2)/Math.pow(a,2)-2*r*(t-n)*(e-o)/2*a*i+Math.pow(e-o,2)/Math.pow(i,2)))};function M(t,e){console.log("重设");var a=t.getContext("2d");a.clearRect(0,0,t.width,t.height),t.width=e.width,t.height=e.height,a.putImageData(e,0,0)}function H(t,e){var a=t.getContext("2d"),i=a.getImageData(0,0,t.width,t.height),n=new String;switch(e){case 0:_(a,i),n="反色";break;case 1:V(a,i),n="去色";break;case 2:W(a,i),n="浮雕";break;case 3:B(a,i),n="水平翻转";break;case 4:D(a,i),n="垂直翻转";break;case 5:E(a,i),n="黑白";break;case 6:T(a,i),n="虚化";break;case 7:n="裁剪";break;case 8:n="缩放";break;case 9:n="旋转";break;default:console.log("未定义的功能");break}return{data:i,name:n}}function _(t,e){console.log("反色");for(var a=e.data.length/4,i=0;i<a;i++)e.data[4*i]=255-e.data[4*i],e.data[4*i+1]=255-e.data[4*i+1],e.data[4*i+2]=255-e.data[4*i+2];t.putImageData(e,0,0)}function V(t,e){console.log("去色");for(var a=e.data.length/4,i=0;i<a;i++){var n=e.data[4*i],o=e.data[4*i+1],r=e.data[4*i+2],s=.3*n+.59*o+.11*r;e.data[4*i]=s,e.data[4*i+1]=s,e.data[4*i+2]=s}t.putImageData(e,0,0)}function W(t,e){console.log("浮雕");for(var a=e.data[0],i=e.data[1],n=e.data[2],o=e.data.length/4,r=0;r<o;r++){var s=e.data[4*r],c=e.data[4*r+1],l=e.data[4*r+2];e.data[4*r]+=128-a,e.data[4*r+1]+=128-i,e.data[4*r+2]+=128-n,a=s,i=c,n=l}t.putImageData(e,0,0)}function B(t,e){console.log("水平翻转");for(var a=e.width,i=e.height,n=4*a/2,o=0;o<i;o++)for(var r=o*a*4,s=(o+1)*a*4-4,c=s-n;r<=c;r+=4,s-=4){var l=e.data[r],u=e.data[r+1],d=e.data[r+2],h=e.data[r+3];e.data[r]=e.data[s],e.data[r+1]=e.data[s+1],e.data[r+2]=e.data[s+2],e.data[r+3]=e.data[s+3],e.data[s]=l,e.data[s+1]=u,e.data[s+2]=d,e.data[s+3]=h}t.putImageData(e,0,0)}function D(t,e){console.log("垂直翻转");for(var a=e.width,i=e.height,n=Math.floor(i/2),o=4*a,r=0;r<n;r++)for(var s=r*o,c=(i-r-1)*o;s<o*(r+1);s+=4,c+=4){var l=e.data[s],u=e.data[s+1],d=e.data[s+2],h=e.data[s+3];e.data[s]=e.data[c],e.data[s+1]=e.data[c+1],e.data[s+2]=e.data[c+2],e.data[s+3]=e.data[c+3],e.data[c]=l,e.data[c+1]=u,e.data[c+2]=d,e.data[c+3]=h}t.putImageData(e,0,0)}function E(t,e){console.log("黑白");for(var a=e.data.length,i=0;i<a;i+=4){var n=e.data[i],o=e.data[i+1],r=e.data[i+2],s=parseInt(.3*n+.59*o+.11*r)>=128?255:0;e.data[i]=s,e.data[i+1]=s,e.data[i+2]=s}t.putImageData(e,0,0)}function T(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;console.log("虚化");for(var i=e.width,n=e.height,o=e.data,r=R(O(a)),s=0;s<n;s++)for(var c=0;c<i;c++){for(var l=[],u=[],d=[],h=[],m=-Math.abs(a);m<=Math.abs(a);m++)if(!(s+m<0||s+m>=n))for(var g=-Math.abs(a);g<=Math.abs(a);g++)if(!(c+g<0||c+g>=i)){var p=4*((s+m)*i+c+g);l.push(o[p]),u.push(o[p+1]),d.push(o[p+2]),h.push(o[p+3])}e.data[4*(s*i+c)]=L(r,l),e.data[4*(s*i+c)+1]=L(r,u),e.data[4*(s*i+c)+2]=L(r,d),e.data[4*(s*i+c)+3]=L(r,h)}t.putImageData(e,0,0)}var X={name:"leftSidebar",computed:Object(l["a"])({},Object(u["e"])({opList:function(t){return t.opList},canvas:function(t){return t.canvas},cxt:function(t){return t.cxt},clipState:function(t){return t.clip.clipState},scaleState:function(t){return t.scale.scaleState},scaleRatio:function(t){return t.scale.scaleRatio},rotateState:function(t){return t.rotate.rotateState}})),data:function(){return{items:[{icon:"mdi-pencil",title:"基础编辑",items:[{title:"水平翻转",action:this.basicOP,funcId:3},{title:"垂直翻转",action:this.basicOP,funcId:4},{title:"裁剪",action:this.clipping,funcId:7},{title:"缩放",action:this.scaling,funcId:8},{title:"旋转",action:this.rotating,funcId:9}]},{icon:"mdi-pencil",title:"风格编辑",items:[{title:"反色",action:this.basicOP,funcId:0},{title:"去色",action:this.basicOP,funcId:1},{title:"浮雕",action:this.basicOP,funcId:2},{title:"黑白",action:this.basicOP,funcId:5},{title:"虚化",action:this.basicOP,funcId:6}]}],opCheckList:[{op:this.getClipState,name:"裁剪",todo:this.endClip,param:0},{op:this.getScaleState,name:"缩放",todo:this.endScaling,param:0},{op:this.getRotateState,name:"旋转",todo:this.endRotating,param:0}]}},methods:Object(l["a"])({},Object(u["c"])("clip",["getClipState"]),{},Object(u["c"])("scale",["getScaleState"]),{},Object(u["c"])("rotate",["getRotateState"]),{},Object(u["b"])("clip",["initClip","endClip"]),{},Object(u["b"])("scale",["initScaling","endScaling"]),{},Object(u["b"])("rotate",["initRotation","endRotating"]),{preCheck:function(){for(var t=0,e=this.opCheckList.length;t<e;t++){var a=this.opCheckList[t];if(a.op()){var i=a.name+"结果尚未保存，是否放弃？";return confirm(i)&&a.todo(a.param),!1}}return!0},basicOP:function(t){this.preCheck()&&(this.opList.removeBackPart(),this.opList.push(H(this.canvas,t)),console.log("opList: ",this.opList))},clipping:function(t){this.preCheck()&&this.initClip(t)},scaling:function(t){this.preCheck()&&this.initScaling(t)},rotating:function(t){this.preCheck()&&this.initRotation(t)}})},Y=X,N=a("8860"),z=a("56b0"),A=a("da13"),F=a("5d23"),U=Object(m["a"])(Y,P,C,!1,null,null,null),$=U.exports;p()(U,{VContainer:b["a"],VList:N["a"],VListGroup:z["a"],VListItem:A["a"],VListItemContent:F["a"],VListItemTitle:F["b"]});var G=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-container",{attrs:{fluid:""}},[a("v-row",[a("v-col",{attrs:{cols:"12"}},[a("v-row",{attrs:{align:"center",justify:"center"}},[a("v-btn-toggle",{attrs:{dense:"",borderless:"","background-color":"white accent-3"}},[a("v-btn",{on:{click:t.undo}},[a("v-icon",{attrs:{dark:""}},[t._v("mdi-undo")])],1),a("v-btn",{on:{click:t.redo}},[a("v-icon",{attrs:{dark:""}},[t._v("mdi-redo")])],1),a("v-btn",{on:{click:t.resetToOrigin}},[a("v-icon",{attrs:{dark:""}},[t._v("mdi-restore")])],1)],1)],1)],1)],1),a("v-subheader",[t._v("历史记录")]),a("v-list",{attrs:{shaped:""}},[a("v-list-item-group",{attrs:{color:"primary"},model:{value:t.curPointer,callback:function(e){t.curPointer=e},expression:"curPointer"}},t._l(this.opList.items,(function(e,i){return a("v-list-item",{key:i,on:{click:function(e){return t.setTo(i)}}},[a("v-list-item-content",[a("v-list-item-title",{domProps:{textContent:t._s(e.name)}})],1)],1)})),1)],1)],1)},J=[],q={name:"rightSidebar",data:function(){return{curPointer:0,opCheckList:[{op:this.getClipState,name:"裁剪",todo:this.endClip,param:0},{op:this.getScaleState,name:"缩放",todo:this.endScaling,param:0},{op:this.getRotateState,name:"旋转",todo:this.endRotating,param:0}]}},watch:{listenList:{handler:function(t){this.curPointer=t}}},computed:Object(l["a"])({},Object(u["e"])(["opList","canvas","cxt","originImgInfo"]),{listenList:function(){return this.opList.getCurPtr()}}),methods:Object(l["a"])({},Object(u["c"])("clip",["getClipState"]),{},Object(u["c"])("scale",["getScaleState"]),{},Object(u["c"])("rotate",["getRotateState"]),{},Object(u["b"])("clip",["endClip"]),{},Object(u["b"])("scale",["endScaling"]),{},Object(u["b"])("rotate",["endRotating"]),{},Object(u["d"])(["setToOrigin"]),{preCheck:function(){for(var t=0,e=this.opCheckList.length;t<e;t++){var a=this.opCheckList[t];if(a.op()){var i=a.name+"结果尚未保存，是否放弃？";if(!confirm(i))return!1;a.todo(a.param)}}return!0},resetToOrigin:function(){confirm("您点击了恢复原图，该操作不可撤销，是否确认？")&&(this.setToOrigin(),this.opList.clear(),this.opList.push({data:this.originImgInfo,name:"原图"}),console.log("opList:",this.opList.size()))},undo:function(){if(this.preCheck())if(0!=this.opList.getCurPtr()){console.log("undo canvas ",this.canvas);var t=this.opList.getNowAndForward();M(this.canvas,t.data),console.log("opList:",this.opList.size())}else alert("没有可以撤销的操作了")},redo:function(){if(this.preCheck())if(this.opList.getCurPtr()!=this.opList.size()-1){var t=this.opList.getNowAndBackward(),e=t.data;M(this.canvas,e),console.log("opList:",this.opList.size())}else alert("没有可以重做的操作了")},setTo:function(t){if(this.preCheck()){var e=this.opList.getAndSetNow(t);if(void 0!=e){console.log("history i: ",t);var a=e.data;M(this.canvas,a)}else console.log("非法操作")}}})},K=q,Q=a("a609"),Z=a("1baa"),tt=a("e0c7"),et=Object(m["a"])(K,G,J,!1,null,null,null),at=et.exports;p()(et,{VBtn:v["a"],VBtnToggle:Q["a"],VCol:f["a"],VContainer:b["a"],VIcon:x["a"],VList:N["a"],VListItem:A["a"],VListItemContent:F["a"],VListItemGroup:Z["a"],VListItemTitle:F["b"],VRow:w["a"],VSubheader:tt["a"]});var it={props:{source:String},data:function(){return{drawer:null,drawerRight:null,left:!1,right:!1,barColor:"black",originImgData:void 0}},components:{midBlock:y,leftSidebar:$,rightSidebar:at}},nt=it,ot=a("7496"),rt=a("40dc"),st=a("5bc1"),ct=a("a75b"),lt=a("553a"),ut=a("f774"),dt=a("2fa4"),ht=a("2a7f"),mt=Object(m["a"])(nt,n,o,!1,null,null,null),gt=mt.exports;p()(mt,{VApp:ot["a"],VAppBar:rt["a"],VAppBarNavIcon:st["a"],VContainer:b["a"],VContent:ct["a"],VFooter:lt["a"],VList:N["a"],VListItem:A["a"],VNavigationDrawer:ut["a"],VRow:w["a"],VSpacer:dt["a"],VToolbarTitle:ht["a"]});var pt=a("f309");i["a"].use(pt["a"]);var vt=new pt["a"]({}),ft={namespaced:!0,state:{clipState:!1,afterValidClick:!1,funcId:null,boxParams:{X:null,Y:null,W:null,H:null,currentX:null,currentY:null,kind:null},boxStyle:{position:"absolute",border:"1px solid black",height:"0",width:"0",left:"0",top:"0"}},getters:{getClipState:function(t){return t.clipState}},mutations:{mouseDownEvent:function(t,e){!t.clipState||"box"!==e.target.parentNode.id&&"box"!==e.target.id||(console.log("点击落在裁剪框内",e.target.parentNode.id,e.target.id,t.boxParams),t.afterValidClick=!0,t.boxParams.currentX=e.clientX,t.boxParams.currentY=e.clientY,t.boxParams.kind=e.target.id)},setBoxParams:function(t,e){t.boxParams.X=e.X,t.boxParams.Y=e.Y,t.boxParams.W=e.W,t.boxParams.H=e.H},resetAll:function(t){t.afterValidClick=!1,t.boxParams.X=null,t.boxParams.Y=null,t.boxParams.W=null,t.boxParams.H=null,t.boxParams.currentX=null,t.boxParams.currentY=null,t.boxParams.kind=null}},actions:{initClip:function(t,e){var a=t.dispatch,i=t.state,n=t.rootState,o=t.commit;console.log("裁剪初始化"),i.funcId=e,i.clipState=!0,n.showLowerSide=!1,o("resetAll"),n.clipMask.width=n.canvas.width,n.clipMask.height=n.canvas.height,n.clipFrame.style.width=n.canvas.width+"px",n.clipFrame.style.height=n.canvas.height+"px",console.log(n.clipFrame);var r=Math.min(n.canvas.width,n.canvas.height),s=(n.canvas.width-r)/2,c=(n.canvas.height-r)/2;o("setBoxParams",{X:s,Y:c,W:r,H:r}),i.boxStyle.height=i.boxStyle.width=r+"px",i.boxStyle.left=s+"px",i.boxStyle.top=c+"px",a("drawTrim")},mouseMoveEvent:function(t,e){var a=t.dispatch,i=t.state,n=t.rootState;if(i.afterValidClick&&i.clipState){console.log("mouseMoveEvent",e);var o=e.clientX,r=e.clientY,s=o-i.boxParams.currentX,c=r-i.boxParams.currentY,l=i.boxParams.X,u=i.boxParams.Y,d=i.boxParams.W,h=i.boxParams.H,m=[0,n.canvas.width],g=[0,n.canvas.height],p=[0,n.canvas.width],v=[0,n.canvas.height];"UC"===i.boxParams.kind?(u+=c,h-=c,g[1]=v[1]=i.boxParams.H+i.boxParams.Y):"LC"===i.boxParams.kind?(l+=s,d-=s,m[1]=p[1]=i.boxParams.W+i.boxParams.X):"RC"===i.boxParams.kind?(d+=s,m[0]=i.boxParams.X,p[1]-=i.boxParams.X):"DC"===i.boxParams.kind?(h+=c,g[0]=i.boxParams.Y,v[1]-=i.boxParams.Y):"LU"===i.boxParams.kind?(l+=s,d-=s,u+=c,h-=c,m[1]=p[1]=i.boxParams.W+i.boxParams.X,g[1]=v[1]=i.boxParams.H+i.boxParams.Y):"RU"===i.boxParams.kind?(u+=c,h-=c,d+=s,m[0]=i.boxParams.X,p[1]-=i.boxParams.X,g[1]=v[1]=i.boxParams.H+i.boxParams.Y):"LD"===i.boxParams.kind?(l+=s,d-=s,h+=c,m[1]=p[1]=i.boxParams.W+i.boxParams.X,g[0]=i.boxParams.Y,v[1]-=i.boxParams.Y):"RD"===i.boxParams.kind?(d+=s,h+=c,m[0]=i.boxParams.X,p[1]-=i.boxParams.X,g[0]=i.boxParams.Y,v[1]-=i.boxParams.Y):(l+=s,u+=c,m[1]-=i.boxParams.W,g[1]-=i.boxParams.H),i.boxStyle.top=Math.max(g[0],Math.min(g[1],u))+"px",i.boxStyle.left=Math.max(m[0],Math.min(m[1],l))+"px",i.boxStyle.height=Math.max(v[0],Math.min(v[1],h))+"px",i.boxStyle.width=Math.max(p[0],Math.min(p[1],d))+"px",console.log(i.boxParams.kind,i.boxStyle.left,i.boxStyle.top,i.boxStyle.width,i.boxStyle.height),a("drawTrim")}},mouseReleaseEvent:function(t){var e=t.state,a=t.commit;e.afterValidClick&&e.clipState&&(e.afterValidClick=!1,a("setBoxParams",{X:parseInt(e.boxStyle.left),Y:parseInt(e.boxStyle.top),W:parseInt(e.boxStyle.width),H:parseInt(e.boxStyle.height)}))},drawTrim:function(t){var e=t.state,a=t.rootState;console.log("drawTrim"),a.maskCxt.clearRect(0,0,a.clipMask.width,a.clipMask.height),a.maskCxt.save(),a.maskCxt.fillStyle="rgba(166, 166, 166, 0.6)",a.maskCxt.fillRect(0,0,a.clipMask.width,a.clipMask.height),a.maskCxt.globalCompositeOperation="source-atop",a.maskCxt.clearRect(parseInt(e.boxStyle.left),parseInt(e.boxStyle.top),parseInt(e.boxStyle.width),parseInt(e.boxStyle.height)),a.maskCxt.restore()},endClip:function(t,e){return Object(c["a"])(regeneratorRuntime.mark((function a(){var i,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=t.rootState,n=t.dispatch,a.next=3,n("exit",e);case 3:console.log("退出裁剪"),i.showLowerSide=!0;case 5:case"end":return a.stop()}}),a)})))()},exit:function(t,e){var a=t.state,i=t.rootState,n=t.commit;if(0!=e){var o=i.cxt.getImageData(a.boxParams.X,a.boxParams.Y,a.boxParams.W,a.boxParams.H);return console.log(o),i.cxt.clearRect(0,0,i.canvas.width,i.canvas.height),i.maskCxt.clearRect(0,0,i.clipMask.width,i.clipMask.height),i.canvas.width=a.boxParams.W,i.canvas.height=a.boxParams.H,i.cxt.putImageData(o,0,0),a.clipState=!1,console.log("裁剪完成"),new Promise((function(t){i.opList.removeBackPart(),i.opList.push(H(i.canvas,a.funcId)),console.log("历史记录已更新"),t()}))}i.maskCxt.clearRect(0,0,i.clipMask.width,i.clipMask.height),n("resetAll"),a.clipState=!1}}},bt=ft,xt={namespaced:!0,state:{scaleState:!1,scaleRatio:100,curImg:null,imgW:0,imgH:0,max:null,funcId:null},getters:{getScaleState:function(t){return t.scaleState}},mutations:{setScaleRatio:function(t,e){t.scaleRatio=e}},actions:{setImgByCanvas:function(t){var e=t.state,a=t.rootState;return new Promise((function(t){e.imgW=a.canvas.width,e.imgH=a.canvas.height,e.curImg=new Image,e.curImg.crossOrigin="",e.curImg.src=a.canvas.toDataURL(),e.curImg.onload=function(){t()},e.curImg.complete&&t()}))},initScaling:function(t,e){return Object(c["a"])(regeneratorRuntime.mark((function a(){var i,n,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=t.state,n=t.rootState,o=t.dispatch,console.log("缩放初始化"),i.funcId=e,n.showLowerSide=!1,a.next=6,o("setImgByCanvas");case 6:i.max=200*n.edgeH/i.imgH,i.scaleRatio=100,n.canvas.width=n.edgeW,n.canvas.height=n.edgeH,n.cxt.drawImage(i.curImg,(n.canvas.width-i.imgW)/2,(n.canvas.height-i.imgH)/2),i.scaleState=!0;case 12:case"end":return a.stop()}}),a)})))()},reScale:function(t){var e=t.state,a=t.rootState;if(e.scaleState){console.log("重新缩放");var i=e.scaleRatio/100;a.cxt.clearRect(0,0,a.canvas.width,a.canvas.height),a.cxt.save(),a.cxt.translate(a.canvas.width/2,a.canvas.height/2),a.cxt.scale(i,i),a.cxt.drawImage(e.curImg,-e.imgW/2,-e.imgH/2),a.cxt.restore()}},endScaling:function(t,e){return Object(c["a"])(regeneratorRuntime.mark((function a(){var i,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=t.rootState,n=t.dispatch,a.next=3,n("exit",e);case 3:console.log("退出缩放"),i.showLowerSide=!0;case 5:case"end":return a.stop()}}),a)})))()},exit:function(t,e){var a=t.state,i=t.rootState;if(0!=e){console.log("确认缩放",e);var n=a.scaleRatio/100;i.cxt.clearRect(0,0,i.canvas.width,i.canvas.height);var o,r,s=0,c=0,l=a.imgW*n,u=a.imgH*n;return console.log("test:",l,u),l<=i.edgeW&&u<=i.edgeH?(i.canvas.width=l,i.canvas.height=u,o=a.imgW,r=a.imgH):(s=Math.max((l-i.edgeW)/(2*n),0),c=Math.max((u-i.edgeH)/(2*n),0),o=Math.min(i.edgeW,l)/n,r=Math.min(i.edgeH,u)/n,i.canvas.width=Math.min(i.edgeW,l),i.canvas.height=Math.min(i.edgeH,u)),i.cxt.drawImage(a.curImg,s,c,o,r,0,0,i.canvas.width,i.canvas.height),new Promise((function(t){i.opList.removeBackPart(),i.opList.push(H(i.canvas,a.funcId)),console.log("历史记录已更新"),a.scaleState=!1,t()}))}console.log("取消缩放",e),i.cxt.clearRect(0,0,i.canvas.width,i.canvas.height),i.canvas.width=a.imgW,i.canvas.height=a.imgH,i.cxt.drawImage(a.curImg,0,0),a.scaleState=!1}}},wt=xt,St={namespaced:!0,state:{rotateState:!1,theta:0,curImg:null,imgW:0,imgH:0,funcId:null},getters:{getRotateState:function(t){return t.rotateState}},mutations:{setTheta:function(t,e){t.theta=e}},actions:{setImgByCanvas:function(t){var e=t.state,a=t.rootState;return new Promise((function(t){e.imgW=a.canvas.width,e.imgH=a.canvas.height,e.curImg=new Image,e.curImg.crossOrigin="",e.curImg.src=a.canvas.toDataURL(),e.curImg.onload=function(){t()},e.curImg.complete&&t()}))},initRotation:function(t,e){return Object(c["a"])(regeneratorRuntime.mark((function a(){var i,n,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=t.state,n=t.rootState,o=t.dispatch,console.log("旋转初始化"),i.funcId=e,n.showLowerSide=!1,a.next=6,o("setImgByCanvas");case 6:i.theta=0,i.rotateState=!0;case 8:case"end":return a.stop()}}),a)})))()},reRotate:function(t){var e=t.state,a=t.rootState;e.rotateState&&(console.log("重新旋转"),a.cxt.clearRect(0,0,a.canvas.width,a.canvas.height),a.cxt.save(),a.cxt.translate(a.canvas.width/2,a.canvas.height/2),a.cxt.rotate(e.theta*Math.PI/180),a.cxt.drawImage(e.curImg,-e.imgW/2,-e.imgH/2),a.cxt.restore())},endRotating:function(t,e){return Object(c["a"])(regeneratorRuntime.mark((function a(){var i,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=t.rootState,n=t.dispatch,a.next=3,n("exit",e);case 3:console.log("退出旋转"),i.showLowerSide=!0;case 5:case"end":return a.stop()}}),a)})))()},exit:function(t,e){var a=t.state,i=t.rootState;if(0!=e)return console.log("确认旋转",e),new Promise((function(t){i.opList.removeBackPart(),i.opList.push(H(i.canvas,a.funcId)),console.log("历史记录已更新"),a.rotateState=!1,t()}));console.log("取消旋转",e),i.cxt.clearRect(0,0,i.canvas.width,i.canvas.height),i.canvas.width=a.imgW,i.canvas.height=a.imgH,i.cxt.drawImage(a.curImg,0,0),a.rotateState=!1}}},kt=St,It=(a("a434"),a("d4ec")),yt=a("bee2"),Pt=function(){function t(e){Object(It["a"])(this,t),this.items=[],this.curPtr=-1,this.capacity=e}return Object(yt["a"])(t,[{key:"getCurPtr",value:function(){return this.curPtr}},{key:"getNowAndForward",value:function(){if(!(this.curPtr<0))return this.curPtr--,this.items[this.curPtr]}},{key:"getNowAndBackward",value:function(){if(!(this.curPtr<0))return this.curPtr++,this.items[this.curPtr]}},{key:"getAndSetNow",value:function(t){if(!(t<0||t>this.size()))return this.curPtr=t,this.items[this.curPtr]}},{key:"removeBackPart",value:function(){-1!=this.curPtr&&this.items.splice(this.curPtr+1)}},{key:"push",value:function(t){void 0!=t?(this.items.length==this.capacity&&(this.items.shift(),console.log("超过容量，挤掉底部元素"),this.curPtr--),this.items.push(t),this.curPtr++):console.log("push undefined.")}},{key:"size",value:function(){return this.items.length}},{key:"clear",value:function(){this.items.splice(0,this.items.length),this.curPtr=-1}}]),t}();i["a"].use(u["a"]);var Ct=new u["a"].Store({modules:{clip:bt,scale:wt,rotate:kt},state:{opList:new Pt(10),canvas:null,cxt:null,clipMask:null,maskCxt:null,clipFrame:null,originImgInfo:null,edgeW:null,edgeH:null,showLowerSide:!0},mutations:{storeInterfaces:function(t,e){t.canvas=e.canvas,t.cxt=t.canvas.getContext("2d"),t.clipMask=e.clipMask,t.maskCxt=t.clipMask.getContext("2d"),t.clipFrame=e.clipFrame},setEdge:function(t,e){t.edgeH=e.edgeH,t.edgeW=e.edgeW},storeOriginImgInfo:function(t){t.opList.clear(),t.originImgInfo=t.cxt.getImageData(0,0,t.canvas.width,t.canvas.height),t.opList.push({data:t.originImgInfo,name:"原图"})},setToOrigin:function(t){t.cxt.clearRect(0,0,t.canvas.width,t.canvas.height),t.canvas.width=t.originImgInfo.width,t.canvas.height=t.originImgInfo.height,t.cxt.putImageData(t.originImgInfo,0,0)}}}),Rt=Ct;i["a"].config.productionTip=!1,new i["a"]({el:"#app",store:Rt,vuetify:vt,render:function(t){return t(gt)}})},a76c:function(t,e,a){t.exports=a.p+"img/default1.3848437a.png"},b977:function(t,e,a){t.exports=a.p+"img/default2.879a0139.png"},c039:function(t,e,a){t.exports=a.p+"img/default3.62d0c72d.png"}});
//# sourceMappingURL=app.aee60318.js.map