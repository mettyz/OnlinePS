(function(t){function e(e){for(var n,r,s=e[0],c=e[1],l=e[2],u=0,h=[];u<s.length;u++)r=s[u],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&h.push(i[r][0]),i[r]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);d&&d(e);while(h.length)h.shift()();return o.push.apply(o,l||[]),a()}function a(){for(var t,e=0;e<o.length;e++){for(var a=o[e],n=!0,s=1;s<a.length;s++){var c=a[s];0!==i[c]&&(n=!1)}n&&(o.splice(e--,1),t=r(r.s=a[0]))}return t}var n={},i={app:0},o=[];function r(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=n,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(a,n,function(e){return t[e]}.bind(null,n));return a},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var l=0;l<s.length;l++)e(s[l]);var d=c;o.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"56d7":function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-app",{attrs:{id:"inspire"}},[a("v-app-bar",{attrs:{app:"","clipped-right":"",color:t.barColor,dark:""}},[a("v-app-bar-nav-icon",{on:{click:function(e){e.stopPropagation(),t.drawer=!t.drawer}}}),a("v-toolbar-title",[t._v("OnlinePS")]),a("v-spacer")],1),a("v-navigation-drawer",{attrs:{app:"",width:"auto"},model:{value:t.drawer,callback:function(e){t.drawer=e},expression:"drawer"}},[a("v-list",{attrs:{dense:""}},[a("v-list-item",[a("basicOperate",{attrs:{canvas:t.canvas,origin:t.originImgData}})],1)],1)],1),a("v-navigation-drawer",{attrs:{fixed:"",temporary:""},model:{value:t.left,callback:function(e){t.left=e},expression:"left"}}),a("v-content",[a("v-container",{staticClass:"fill-height",attrs:{fluid:""}},[a("v-row",{attrs:{justify:"center",align:"center"}},[a("midBlock",{on:{canvasReady:t.canvasReady}})],1)],1)],1),a("v-navigation-drawer",{attrs:{fixed:"",right:"",temporary:""},model:{value:t.right,callback:function(e){t.right=e},expression:"right"}}),a("v-footer",{staticClass:"white--text",attrs:{app:"",color:t.barColor}},[a("span",[t._v("SETeam06")]),a("v-spacer"),a("span",[t._v("© 2020")])],1)],1)},o=[],r=(a("d3b7"),a("8a59"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("d5d6"),a("82f8"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("170b"),a("b39a"),a("72f7"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-container",{attrs:{fluid:""}},[n("v-row",[n("v-col",{attrs:{cols:"12"}},[n("v-row",{staticClass:"grey lighten-5",attrs:{align:"center",justify:"center"}},[n("img",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"myImg",attrs:{src:a("7705")}}),n("canvas",{ref:"myCanvas",attrs:{id:"user-img"}})]),n("v-row",{attrs:{align:"stretch",justify:"center"}},[n("form",{attrs:{enctype:"multipart/form-data"}},[n("v-btn",{staticClass:"ma-2",on:{click:t.choose}},[t._v(" 选择图片 ")]),n("v-btn",{staticClass:"ma-2",on:{click:t.upload}},[t._v(" 上传图片 "),n("input",{staticStyle:{display:"none"},attrs:{id:"img-file",type:"file"},on:{change:t.getUserImg}})]),n("v-btn",{staticClass:"ma-2",on:{click:t.download}},[t._v(" 保存图片 ")])],1)])],1)],1)],1)}),s=[],c=(a("3ca3"),a("ddb0"),a("2b3d"),a("96cf"),a("1da1")),l={name:"midBlock",data:function(){return{}},mounted:function(){console.log("进入预设函数");var t=this.$refs.myCanvas,e=this.$refs.myImg;if(t.getContext){console.log("浏览器支持Canvas!");var a=t.getContext("2d");e.onload=function(){var n=.75;t.width=Math.min(document.body.clientWidth*n,e.width),t.height=Math.min(document.body.clientHeight*n,e.height);var i=t.width/e.width,o=t.height/e.height,r=i<o?i:o;r=Math.min(1,r);var s=e.width*r,c=e.height*r;t.width=s,t.height=c,console.log("绘制预设图像"),a.drawImage(e,0,0,s,c)}}else console.log("浏览器不支持Canvas!")},methods:{setDefaultImg:function(){},upload:function(){document.getElementById("img-file").click()},download:function(){console.log("图片下载到本地");var t=document.createElement("a"),e=document.getElementById("user-img");e.toBlob((function(e){t.download="imgFile.jpeg",t.href=URL.createObjectURL(e),t.click()}),"image/jpeg",1)},choose:function(){console.log("选一张默认图片")},getUserImg:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.preprocess();case 2:e=t.sent,console.log("准备将画布传给父组件",e),this.$emit("canvasReady",e);case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),preprocess:function(){return new Promise((function(t){var e=document.getElementById("img-file"),a=document.getElementById("user-img");if(a.getContext){console.log("浏览器支持Canvas!");var n=a.getContext("2d");if(e.value){var i=e.files[0];console.log("清除画布"),n.clearRect(0,0,a.offsetWidth,a.offsetHeight);var o=new FileReader;o.readAsDataURL(i),o.onload=function(e){var i=new Image;i.src=e.target.result,i.onload=function(){var e=.75;a.width=Math.min(document.body.clientWidth*e,i.width),a.height=Math.min(document.body.clientHeight*e,i.height);var o=a.width/i.width,r=a.height/i.height,s=o<r?o:r;s=Math.min(1,s);var c=i.width*s,l=i.height*s;a.width=c,a.height=l,n.drawImage(i,0,0,c,l),console.log("画布准备返回"),t(a)}}}}else console.log("浏览器不支持Canvas!")}))}}},d=l,u=a("2877"),h=a("6544"),g=a.n(h),f=a("8336"),v=a("62ad"),p=a("a523"),m=a("0fd9"),b=Object(u["a"])(d,r,s,!1,null,null,null),w=b.exports;g()(b,{VBtn:f["a"],VCol:v["a"],VContainer:p["a"],VRow:m["a"]});var y=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-container",{attrs:{fluid:""}},[a("v-row",[a("v-col",{attrs:{cols:"12"}},[a("v-row",{attrs:{align:"center",justify:"center"}},[a("v-btn-toggle",{attrs:{dense:"",borderless:"","background-color":"white accent-3"}},[a("v-btn",{on:{click:t.undo}},[a("v-icon",{attrs:{dark:""}},[t._v("mdi-undo")])],1),a("v-btn",{on:{click:t.redo}},[a("v-icon",{attrs:{dark:""}},[t._v("mdi-redo")])],1),a("v-btn",{on:{click:t.resetToOrigin}},[a("v-icon",{attrs:{dark:""}},[t._v("mdi-restore")])],1)],1)],1)],1)],1),a("v-list",t._l(t.items,(function(e){return a("v-list-group",{key:e.title,attrs:{"prepend-icon":e.icon,"no-action":""},scopedSlots:t._u([{key:"activator",fn:function(){return[a("v-list-item-content",[a("v-list-item-title",{domProps:{textContent:t._s(e.title)}})],1)]},proxy:!0}],null,!0)},t._l(e.items,(function(n,i){return a("v-list-item",{key:n.title,on:{click:function(t){return e.action(i)}}},[a("v-list-item-content",[a("v-list-item-title",{domProps:{textContent:t._s(n.title)}})],1)],1)})),1)})),1)],1)},k=[],L=(a("a434"),a("d4ec")),C=a("bee2"),x=function(){function t(e){Object(L["a"])(this,t),this.element=[],this.cap=e}return Object(C["a"])(t,[{key:"push",value:function(t){void 0!=t?(this.element.length==this.cap&&(this.element.shift(),console.log("超过容量，挤掉栈底")),this.element.push(t)):console.log("push undefined.")}},{key:"pop",value:function(){if(0!=this.element.length)return this.element.pop()}},{key:"size",value:function(){return this.element.length}},{key:"empty",value:function(){return 0==this.element.length}},{key:"clear",value:function(){this.element.splice(0,this.element.length),this.top=0}}]),t}();function I(t,e){console.log("重设 或 重做",t,e);var a=t.getContext("2d"),n=a.getImageData(0,0,t.width,t.height),i=new Uint8ClampedArray(n.data);return n.data.set(e),a.putImageData(n,0,0),i}function V(t,e){if(console.log("解析图片",t),void 0!==t){var a=t.getContext("2d"),n=a.getImageData(0,0,t.width,t.height),i=new Uint8ClampedArray(n.data);switch(e){case 0:O(a,n);break;case 1:_(a,n);break;case 2:j(a,n);break;default:console.log("未定义的功能");break}return i}alert("画布上还空空如也呢，先选张图片吧！")}function O(t,e){console.log("图片色彩反转");for(var a=e.data.length/4,n=0;n<a;n++)e.data[4*n]=255-e.data[4*n],e.data[4*n+1]=255-e.data[4*n+1],e.data[4*n+2]=255-e.data[4*n+2];t.putImageData(e,0,0)}function _(t,e){console.log("去色");for(var a=e.data.length/4,n=0;n<a;n++){var i=e.data[4*n],o=e.data[4*n+1],r=e.data[4*n+2],s=.3*i+.59*o+.11*r;e.data[4*n]=s,e.data[4*n+1]=s,e.data[4*n+2]=s}t.putImageData(e,0,0)}function j(t,e){console.log("浮雕");for(var a=e.data[0],n=e.data[1],i=e.data[2],o=e.data.length/4,r=0;r<o;r++){var s=e.data[4*r],c=e.data[4*r+1],l=e.data[4*r+2];e.data[4*r]+=128-a,e.data[4*r+1]+=128-n,e.data[4*r+2]+=128-i,a=s,n=c,i=l}t.putImageData(e,0,0)}var R={name:"basicOperate",props:["canvas","origin"],data:function(){return{maxRecord:10,undoList:new x(this.maxRecord),redoList:new x(this.maxRecord),items:[{icon:"mdi-pencil",title:"基础编辑",action:this.basicOP,items:[{title:"色彩反转"},{title:"去色"},{title:"浮雕"}]},{icon:"mdi-pencil",title:"风格编辑",items:[]}]}},methods:{resetToOrigin:function(){"undefined"!=typeof this.origin&&confirm("您点击了恢复原图，该操作不可撤销，是否确认？")&&(I(this.canvas,this.origin),this.undoList.clear(),this.redoList.clear(),console.log("undoList:",this.undoList.size()),console.log("redoList:",this.redoList.size()))},undo:function(){if(this.undoList.empty())alert("没有可以撤销的操作了");else{var t=this.undoList.pop();this.redoList.push(I(this.canvas,t)),console.log("undoList:",this.undoList.size()),console.log("redoList:",this.redoList.size())}},redo:function(){if(this.redoList.empty())alert("没有可以重做的操作了");else{var t=this.redoList.pop();this.undoList.push(I(this.canvas,t)),console.log("undoList:",this.undoList.size()),console.log("redoList:",this.redoList.size())}},basicOP:function(t){this.undoList.push(V(this.canvas,t)),console.log("undoList:",this.undoList.size())}}},P=R,B=a("a609"),D=a("132d"),S=a("8860"),M=a("56b0"),T=a("da13"),E=a("5d23"),z=Object(u["a"])(P,y,k,!1,null,null,null),U=z.exports;g()(z,{VBtn:f["a"],VBtnToggle:B["a"],VCol:v["a"],VContainer:p["a"],VIcon:D["a"],VList:S["a"],VListGroup:M["a"],VListItem:T["a"],VListItemContent:E["a"],VListItemTitle:E["b"],VRow:m["a"]});var A={props:{source:String},data:function(){return{drawer:null,drawerRight:null,left:!1,right:!1,barColor:"black",canvas:void 0,originImgData:void 0}},methods:{canvasReady:function(t){this.canvas=t,console.log("接收到画布",this.canvas);var e=this.canvas.getContext("2d"),a=e.getImageData(0,0,this.canvas.width,this.canvas.height);this.originImgData=new Uint8ClampedArray(a.data),console.log("原图数据解析完成")}},components:{midBlock:w,basicOperate:U}},$=A,F=a("7496"),H=a("40dc"),N=a("5bc1"),W=a("a75b"),J=a("553a"),G=a("f774"),q=a("2fa4"),K=a("2a7f"),Q=Object(u["a"])($,i,o,!1,null,null,null),X=Q.exports;g()(Q,{VApp:F["a"],VAppBar:H["a"],VAppBarNavIcon:N["a"],VContainer:p["a"],VContent:W["a"],VFooter:J["a"],VList:S["a"],VListItem:T["a"],VNavigationDrawer:G["a"],VRow:m["a"],VSpacer:q["a"],VToolbarTitle:K["a"]});var Y=a("f309");n["a"].use(Y["a"]);var Z=new Y["a"]({});n["a"].config.productionTip=!1,new n["a"]({vuetify:Z,render:function(t){return t(X)}}).$mount("#app")},7705:function(t,e,a){t.exports=a.p+"img/default1.ceca253e.jpg"}});
//# sourceMappingURL=app.408d8118.js.map